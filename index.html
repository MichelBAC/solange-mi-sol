<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Solange: Mi Sol</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;300&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">

<style>
body { margin:0; background:#050505; overflow:hidden; font-family:'Montserrat', sans-serif; }
#canvas-container { width:100vw; height:100vh; }

.interface{
    position:absolute; top:0; left:0; width:100%; height:100%;
    pointer-events:none; z-index:10;
    display:flex; flex-direction:column;
    justify-content:space-between; align-items:center;
    padding:40px; box-sizing:border-box;
}

.frase-flotante{
    color:#C5A059; font-size:0.8rem; letter-spacing:4px;
    text-transform:uppercase; opacity:0;
    transition:opacity 2s; text-align:center;
    text-shadow: 0 0 10px rgba(197, 160, 89, 0.5);
}

.card-propuesta{
    background:rgba(5,5,5,0.85);
    border:1px solid #C5A059;
    padding:35px; text-align:center;
    opacity:0; transform:translateY(30px);
    transition:all 1.5s cubic-bezier(0.19,1,0.22,1);
    backdrop-filter: blur(15px);
    box-shadow: 0 0 30px rgba(197, 160, 89, 0.2);
    border-radius: 4px;
}

.card-propuesta.show{
    opacity:1; transform:translateY(0);
    pointer-events:all;
}

h1{
    color:#C5A059;
    font-weight:100;
    font-size:2rem;
    margin-bottom:20px;
    letter-spacing:10px;
}

.italiano {
    font-family: 'Playfair Display', serif;
    color: #C5A059;
    font-style: italic;
    font-size: 1.1rem;
    display: block;
    margin-bottom: 15px;
}

.btn-oro{
    background:none; border:1px solid #C5A059;
    color:#C5A059;
    padding:12px 35px;
    cursor:pointer;
    font-size:0.7rem;
    letter-spacing:2px;
    transition:0.4s;
    margin-top:20px;
    text-transform: uppercase;
}

.btn-oro:hover{ background:#C5A059; color:#000; box-shadow: 0 0 15px #C5A059; }

#loader{
    position:fixed; top:0; left:0;
    width:100%; height:100%;
    background:#050505;
    display:flex; justify-content:center; align-items:center;
    color:#C5A059; z-index:100;
    font-size:0.6rem; letter-spacing:5px;
}
</style>
</head>

<body>

<div id="loader">INICIANDO SISTEMA SOLAR "SOLANGE"...</div>

<div class="interface">
<div id="frase-top" class="frase-flotante">"En mi universo, t칰 eres el 칰nico Sol"</div>

<div id="card" class="card-propuesta">
    <h1 id="titulo-card">SOLANGE</h1>
    <div id="contenido-card">
        <p style="color:#fff; font-size:0.9rem; line-height:1.8;">
        Eres la gravedad que me mantiene en pie.<br>
        쯄e har칤as el honor de ser mi San Valent칤n?
        </p>
        <div style="position:relative; height:60px; display:flex; justify-content:center; align-items:center;">
            <button class="btn-oro" onclick="aceptar()">S칈, ACEPTO</button>
            <button id="btn-no" class="btn-oro"
            style="position:absolute; border-color:#333; color:#555;"
            onmouseover="huir()" ontouchstart="huir()">NO</button>
        </div>
    </div>
</div>

<div id="frase-bottom" class="frase-flotante">Ac칠rcate al sol para descubrir el mensaje</div>
</div>

<div id="canvas-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<script>

let scene, camera, renderer, controls;
let sun, sunLight, corona;
let sunMaterial;
let clock = new THREE.Clock();
let hearts = [];
let supernovaActivada = false;
let aceptado = false;

function init(){

    scene = new THREE.Scene();

    // Ajuste de c치mara inicial
    camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 5000);
    camera.position.z = 1800; // Un poco m치s lejos al inicio porque el sol es m치s grande

    renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    // Habilitar output encoding para mejores colores en el material standard
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    
    document.getElementById("canvas-container").appendChild(renderer.domElement);

    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 0.5;
    controls.maxDistance = 2500;
    controls.minDistance = 250; // Ajustado para no entrar dentro del sol gigante

    crearSol();
    crearEstrellas();
    crearFotos();

    animate();
    entradaInicial();
}

function crearSol(){

    const textureLoader = new THREE.TextureLoader();

    const sunTexture = textureLoader.load('sun.jpg');
    const noiseTexture = textureLoader.load('sun_noise.jpg');

    const sunGeometry = new THREE.SphereGeometry(200, 128, 128);

    // 游댠 SHADER PROFESIONAL CON DISTORSI칍N PLASMA
    sunMaterial = new THREE.ShaderMaterial({
        uniforms: {
            time: { value: 0 },
            texture1: { value: sunTexture },
            noiseTexture: { value: noiseTexture }
        },
        vertexShader: `
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
            }
        `,
        fragmentShader: `
            uniform float time;
            uniform sampler2D texture1;
            uniform sampler2D noiseTexture;
            varying vec2 vUv;

            void main() {

                vec2 uv = vUv;

                // Movimiento org치nico tipo plasma
                vec2 noise = texture2D(noiseTexture, uv + time * 0.05).rg;
                vec2 distortedUv = uv + noise * 0.08;

                vec4 color = texture2D(texture1, distortedUv);

                // Intensidad solar
                gl_FragColor = vec4(color.rgb * 1.6, 1.0);
            }
        `
    });

    sun = new THREE.Mesh(sunGeometry, sunMaterial);
    scene.add(sun);

    sunLight = new THREE.PointLight(0xffaa33, 5, 2000);
    sunLight.position.set(0,0,0);
    scene.add(sunLight);

    const coronaGeometry = new THREE.SphereGeometry(230, 64, 64);
    const coronaMaterial = new THREE.MeshBasicMaterial({
        color: 0xffdd88,
        transparent: true,
        opacity: 0.3,
        side: THREE.BackSide,
        blending: THREE.AdditiveBlending
    });

    corona = new THREE.Mesh(coronaGeometry, coronaMaterial);
    scene.add(corona);
}
function crearEstrellas(){
    const starGeo = new THREE.BufferGeometry();
    const starCoords = [];

    for(let i=0;i<15000;i++){
        starCoords.push(
            (Math.random()-0.5)*4000, // Espacio m치s amplio
            (Math.random()-0.5)*4000,
            (Math.random()-0.5)*4000
        );
    }

    starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starCoords,3));
    const starMat = new THREE.PointsMaterial({ color:0xffffff, size:0.9, transparent:true });
    const starField = new THREE.Points(starGeo, starMat);
    scene.add(starField);
}

let orbitas = [];

function crearFotos(){

    const loader = new THREE.TextureLoader();

    // Tus fotos (aseg칰rate que existan en la carpeta o pon URLs de prueba)
    const fotos = [
    'foto1.jpeg','foto2.jpeg','foto3.jpeg','foto4.jpeg',
    'foto5.jpeg','foto6.jpeg','foto7.jpeg','foto8.jpeg',
    'foto9.jpeg','foto10.jpeg','foto11.jpeg','foto12.jpeg',
    'foto13.jpeg','foto14.jpeg'
    ];

    // Configuraci칩n de 칩rbitas (Radios aumentados porque el Sol ahora mide 200)
    const configuracionOrbitas = [
        { radio: 400, velocidad: 0.002 },
        { radio: 600, velocidad: 0.0015 },
        { radio: 800, velocidad: 0.001 }
    ];

    configuracionOrbitas.forEach(config => {
        const grupo = new THREE.Group();
        grupo.userData = config;
        scene.add(grupo);
        orbitas.push(grupo);
    });

    fotos.forEach((src,index)=>{
        // Si no tienes las fotos locales, esto se ver치 negro, pero la l칩gica funciona
        loader.load(src,(texture)=>{
            const geo = new THREE.CircleGeometry(35,32);
            const mat = new THREE.MeshBasicMaterial({
                map:texture,
                side:THREE.DoubleSide
            });

            const photo = new THREE.Mesh(geo,mat);
            const orbitaIndex = index % configuracionOrbitas.length;
            const grupo = orbitas[orbitaIndex];
            const radio = configuracionOrbitas[orbitaIndex].radio;
            const angulo = (index / fotos.length) * Math.PI * 2;

            photo.position.set(
                Math.cos(angulo)*radio,
                (Math.random()-0.5)*200,
                Math.sin(angulo)*radio
            );

            photo.lookAt(0,0,0);
            grupo.add(photo);
        }, undefined, (err) => {
            // Fallback por si no encuentra la imagen: Crea un circulo dorado
            const geo = new THREE.CircleGeometry(35,32);
            const mat = new THREE.MeshBasicMaterial({ color: 0x333333, side: THREE.DoubleSide });
            const photo = new THREE.Mesh(geo, mat);
             const orbitaIndex = index % configuracionOrbitas.length;
            const grupo = orbitas[orbitaIndex];
            const radio = configuracionOrbitas[orbitaIndex].radio;
            const angulo = (index / fotos.length) * Math.PI * 2;
             photo.position.set(Math.cos(angulo)*radio, (Math.random()-0.5)*200, Math.sin(angulo)*radio);
            photo.lookAt(0,0,0);
            grupo.add(photo);
        });
    });
}

function entradaInicial(){
    // La c치mara viaja hacia el sol pero se detiene antes de chocar (z:900 es seguro para radio 200)
    gsap.to(camera.position,{
        z:900,
        duration:5,
        ease:"expo.inOut",
        onComplete:()=>{
            document.getElementById("loader").style.display="none";
        }
    });
}

function activarSupernova(){
    if(supernovaActivada || aceptado) return;
    supernovaActivada = true;

    // OPCI칍N PRO: Explosi칩n de luz e intensidad
    gsap.to(sun.material, { emissiveIntensity: 5, duration: 2 }); // Brilla m치s
    gsap.to(sunLight, { intensity: 8, duration: 2 }); // Ilumina m치s
    gsap.to(corona.material, { opacity: 0.8, duration: 2 }); // Halo m치s visible
    
    // Expansi칩n del halo
    gsap.fromTo(corona.scale, { x:1,y:1,z:1 }, { x:1.5,y:1.5,z:1.5,duration:2,ease:"power2.out" });

    document.getElementById("frase-top").style.opacity=1;
    document.getElementById("frase-bottom").style.opacity=1;
    document.getElementById("card").classList.add("show");
    controls.autoRotate = false;
}

function crearExplosionCorazones() {
    const heartShape = new THREE.Shape();
    heartShape.moveTo(0, 0);
    heartShape.bezierCurveTo(0, 3, 5, 3, 5, 0);
    heartShape.bezierCurveTo(5, -3, 0, -5, 0, -8);
    heartShape.bezierCurveTo(0, -5, -5, -3, -5, 0);
    heartShape.bezierCurveTo(-5, 3, 0, 3, 0, 0);

    for (let i = 0; i < 400; i++) {
        const geometry = new THREE.ShapeGeometry(heartShape);
        const material = new THREE.MeshBasicMaterial({ color: 0xFFD700, transparent: true, side: THREE.DoubleSide });
        const heart = new THREE.Mesh(geometry, material);
        
        heart.position.copy(sun.position);
        heart.scale.set(0.3, 0.3, 0.3);
        
        // Velocidad aleatoria explosiva
        heart.userData.velocity = new THREE.Vector3(
            (Math.random() - 0.5) * 15,
            (Math.random() - 0.5) * 15,
            (Math.random() - 0.5) * 15
        );
        scene.add(heart);
        hearts.push(heart);
    }
}

function animate(){
    requestAnimationFrame(animate);
    controls.update();

    // Animaci칩n VIVA del sol y la corona
    if(sun) sun.rotation.y += 0.002;
    if(sunMaterial){
    sunMaterial.uniforms.time.value += clock.getDelta();
}
    if(corona) {
        corona.rotation.y -= 0.001;
        corona.lookAt(camera.position); // Truco para que el halo siempre mire a c치mara si quieres, o rotaci칩n normal
    }

    // Peque침o pulso natural (respiraci칩n del sol)
    if(!aceptado && sun) {
        const pulso = 1 + Math.sin(Date.now()*0.001)*0.01;
        sun.scale.set(pulso,pulso,pulso);
        corona.scale.set(pulso*1.15, pulso*1.15, pulso*1.15);
    }

    // Animaci칩n corazones
    hearts.forEach(h => {
        h.position.add(h.userData.velocity);
        h.rotation.z += 0.02;
        h.material.opacity -= 0.005;
    });

    // Detectar distancia para activar carta
    const distance = camera.position.distanceTo(new THREE.Vector3(0,0,0));
    
    // Como el sol mide 200 de radio, activamos la carta a 450 de distancia
    if(distance < 450){
        activarSupernova();
    } else if (distance > 600 && supernovaActivada && !aceptado) {
        // Si se aleja, desactivar supernova (bajar intensidad)
        supernovaActivada = false;
        
        gsap.to(sun.material, { emissiveIntensity: 2, duration: 1 });
        gsap.to(sunLight, { intensity: 5, duration: 1 });
        gsap.to(corona.material, { opacity: 0.3, duration: 1 });
        gsap.to(corona.scale, { x:1,y:1,z:1, duration:1 });

        document.getElementById("card").classList.remove("show");
        document.getElementById("frase-top").style.opacity=0;
        document.getElementById("frase-bottom").style.opacity=0;
        controls.autoRotate = true;
    }

    // Movimiento orbital de fotos
    orbitas.forEach(grupo=>{
        grupo.rotation.y += grupo.userData.velocidad;
    });

    renderer.render(scene,camera);
}

function huir(){
    const btn = document.getElementById("btn-no");
    btn.style.left = Math.random()*70 + "%";
    btn.style.top = Math.random()*70 + "%";
}

function aceptar(){
    aceptado = true;
    
    // UI Cambio de texto
    document.getElementById("titulo-card").innerText = "춰S칈!";
    document.getElementById("contenido-card").innerHTML = `
        <span class="italiano">"Tu sei il mio sole, amore mio 仇벒잺"</span>
        <p style="color:#fff;">Has hecho mi universo completo.<br>Te amo infinitamente, Solange.</p>
    `;

    // Efecto visual de explosi칩n final (Colapso y Big Bang de amor)
    // Primero un destello blanco cegador
    gsap.to(sunLight, { intensity: 50, duration: 0.2, yoyo:true, repeat:1 });
    gsap.to(sun.scale, { x: 0.1, y: 0.1, z: 0.1, duration: 0.4, ease:"back.in", onComplete: () => {
        sun.visible = false;
        corona.visible = false;
        crearExplosionCorazones();
    }});

    // Alejar c치mara para ver la explosi칩n de corazones
    gsap.to(camera.position, {z: 1200, duration: 4, ease: "power2.out"});

    setTimeout(() => {
        window.location.href="https://www.google.com/calendar/render?action=TEMPLATE&text=Cita+con+mi+Sol&details=Te+amo,+Solange.&dates=20260214T190000Z/20260214T230000Z";
    }, 6000);
}

window.addEventListener("resize",()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

init();

</script>
</body>
</html>
